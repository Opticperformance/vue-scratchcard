(function(o,f){typeof exports=="object"&&typeof module!="undefined"?module.exports=f(require("vue")):typeof define=="function"&&define.amd?define(["vue"],f):(o=typeof globalThis!="undefined"?globalThis:o||self,o["vue-scratchcard"]=f(o.Vue))})(this,function(o){"use strict";const f=(e,t,r,a)=>{(!a||a<1)&&(a=1);const c=e.getImageData(0,0,t,r),i=c.data.length/a;let l=0;for(let s=0;s<c.data.length;s+=a)Number(c.data[s])===0&&l++;return Math.round(l/i*100)},w=(e,t)=>{const{left:r,top:a}=e.getBoundingClientRect(),c=t.touches&&t.touches[0];if(c)return{x:c.clientX-r,y:c.clientY-a};const i=window.pageYOffset||document.documentElement.scrollTop,l=window.pageXOffset||document.documentElement.scrollLeft;return{x:t.pageX-r-l,y:t.pageY-a-i}},I=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),O=(e,t)=>Math.atan2(t.x-e.x,t.y-e.y),P=(e,t,r)=>{const{x:a,y:c}=t;if(r)return e.drawImage(r,a-r.width/2,c-r.height/2);e.beginPath(),e.arc(a,c,25,0,2*Math.PI,!1),e.fill()},B=(e,t,r,a)=>{const c=I(t,r),i=O(t,r);let{x:l,y:s}=t;for(let u=0;u<c;u++)l=t.x+Math.sin(i)*u,s=t.y+Math.cos(i)*u,e.globalCompositeOperation="destination-out",P(e,{x:l,y:s},a)},g=e=>Object.keys(e).map(t=>`${t}:${e[t]}`).concat(";"),C={position:"absolute",width:"100%",height:"100%",display:"block"},x=document.createElement("canvas"),E=x.getContext("2d");var H=o.defineComponent({emits:["complete"],props:{imageUrl:{type:String,required:!0},cardWidth:{type:Number,required:!0},cardHeight:{type:Number,required:!0},finishPercent:{type:Number,required:!0},forceReveal:{type:Boolean,default:!1},brushUrl:String},setup(e,{slots:t,emit:r}){const a=o.computed(()=>({position:"relative",display:"block",width:`${e.cardWidth}px`,height:`${e.cardHeight}px`})),c=o.ref(!1),i=o.ref(!1),l=o.ref(!1),s=o.ref(x),u=o.ref(E),v=o.ref({x:0,y:0}),m=new Image;m.crossOrigin="Anonymous",m.src=e.imageUrl;const N=()=>{var n;(n=u.value)==null||n.drawImage(m,0,0,e.cardWidth,e.cardHeight),c.value=!0},y=new Image;e.brushUrl&&(y.crossOrigin="Anonymous",y.src=e.brushUrl);const p=()=>{var d;const n=s.value;l.value||((d=n==null?void 0:n.parentNode)==null||d.removeChild(n),r("complete")),l.value=!0},b=n=>{i.value=!0,v.value=w(s.value,n)},M=()=>{i.value=!1},T=n=>{if(!i.value)return;n.preventDefault();const d=w(s.value,n),q=v.value,h=u.value;if(!h)return;B(h,q,d,y),v.value=d,f(h,e.cardWidth,e.cardHeight,32)>e.finishPercent&&p()};return o.onMounted(()=>{var d;const n=(d=s.value)==null?void 0:d.getContext("2d");if(!n)throw Error(`can't start a CanvasRenderingContext2D from ${s.value}`);u.value=n,m.onload=N}),o.watch(()=>e.forceReveal,n=>n&&p()),()=>{const n=t.default;if(!n)throw Error("please pass a default content slot");const d=o.h("div",{style:g(C)},n()),h=[o.h("canvas",{style:g(C),onMousedown:b,onMousemove:T,onMouseup:M,onTouchstart:b,onTouchmove:T,onTouchend:M,width:e.cardWidth,height:e.cardHeight,ref:s})];return c.value&&h.unshift(d),o.h("div",{style:g(a.value)},h)}}}),L={install(e){e.component("vue-scratchcard",H)}};return L});
